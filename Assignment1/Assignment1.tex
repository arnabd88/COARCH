\documentclass{tufte-handout}

\title{Assignment-1: Performance Metrics}
  
  \author[]{Arnab Das, u1014840}
  
  %\date{28 March 2010} % without \date command, current date is supplied
  
  %\geometry{showframe} % display margins for debugging page layout
  
  \input{preamble}
  
  \begin{document}
  
  \maketitle% this prints the handout title, author, and date
  

 \setcounter{secnumdepth}{1}

\newpage
\section{$\textbf{Summarizing Performance Numbers}$}
	\paragraph{Execution Time:} The expected execution time for each machine can be derived as the arithmetic mean of the individual execution times since the probability of executing each program is equal. Arithmetic mean is defined as 
	
	  \[
	  	ArithMean = \dfrac{\sum_{i=1}^{n=4} x_i}{n}
	  \]

	The evaluation is summarised in ~\ref{tab:exec-time}

	\begin{table}[!htb]
	    \centering
	    \fontfamily{ppl}\selectfont
		\renewcommand{\arraystretch}{3.0}
		\label{tab:exec-time}
	    \begin{tabular}{c|c|c|c|c|c}
	      \toprule
		  \multicolumn{6}{|c|}{Execution Times(S)}  \\
	      \midrule 
		  $\textbf{System}$ & $\textbf{A}$ & $\textbf{B}$ & $\textbf{C}$ & $\textbf{D}$ & $\textbf{WSum}$ \\  % = \dfrac{1}{4}\sum_{i=1}^4 w_i x_i$ 
		  $\textbf{BASE}$ & 3 & 2.5 & 1 & 12 & 4.625 \\
		  $\textbf{NEW1}$ & 7 & 3 & 5 & 1 & 4 \\
		  $\textbf{NEW2}$ & 2 & 1 & 3 & 8 & 3.5 \\
		  $\textbf{NEW3}$ & 1 & 3 & 2 & 13 & 4.75 \\
	      \bottomrule
	    \end{tabular}
	    \caption{ execution times }
	  \end{table}

	  Thus, the computer system resulting in least execution time is $\textbf{NEW2}$.
	

	  \paragraph{Energy: } Similarly, for the least energy consumption we evaluate the arithmetic mean of the energy values over all the programs for each system. The evaluated  arithmetic mean for energy table is shown in ~\ref{tab:exec-energy} 
	  

	  The evaluations are shown in the table ~\ref{tab:exec-energy}. 
	
	\begin{table}[!htb]
	    \centering
	    \fontfamily{ppl}\selectfont
		\renewcommand{\arraystretch}{3.0}
		\label{tab:exec-energy}
	    \begin{tabular}{c|c|c|c|c|c}
	      \toprule
		  \multicolumn{6}{|c|}{System Energy(J)}  \\
	      \midrule 
		  $\textbf{System}$ & $\textbf{A}$ & $\textbf{B}$ & $\textbf{C}$ & $\textbf{D}$ & $\textbf{ArithMean}$ \\  % = \dfrac{1}{4}\sum_{i=1}^4 w_i x_i$ 
		  $\textbf{BASE}$ & 20 & 40 & 50 & 15 & 31.25 \\
		  $\textbf{NEW1}$ & 10 & 30 & 15 & 30 & 21.25 \\
		  $\textbf{NEW2}$ & 30 & 60 & 20 & 20 & 32.5 \\
		  $\textbf{NEW3}$ & 70 & 35 & 30 & 10 & 36.25 \\
	      \bottomrule
	    \end{tabular}
	    \caption{ Energy Consumption }
	  \end{table}

	  Thus the system $\textbf{NEW1}$ has the least energy consumption.

	  \paragraph{Power: } From the defnition of power as
	  	\[
			Power = \dfrac{Energy}{Time} 
		\]

		we can construct the table for $power$ consumption using the corresponding values of energy and execution-times from the given tables using the above equation. Table ~\ref{tab:abs-power} shows the above construction

	\begin{table}[!htb]
	    \centering
	    \fontfamily{ppl}\selectfont
		\renewcommand{\arraystretch}{3.0}
		\label{tab:abs-power}
	    \begin{tabular}{c|c|c|c|c|c}
	      \toprule
		  \multicolumn{6}{|c|}{System Power(W)}  \\
	      \midrule 
		  $\textbf{System}$ & $\textbf{A}$ & $\textbf{B}$ & $\textbf{C}$ & $\textbf{D}$ & $\textbf{AirthMean}$\\  % = \dfrac{1}{4}\sum_{i=1}^4 w_i x_i$ 
		  $\textbf{BASE}$ & $\dfrac{20}{3}=6.67$ & $\dfrac{40}{2.5} = 16$ & $\dfrac{50}{1} = 50$ & $\dfrac{15}{12} = 1.25$  & 18.48 \\ 
		  $\textbf{NEW1}$ & $\dfrac{10}{7}=1.43$ & $\dfrac{30}{3} = 10$ & $\dfrac{15}{5} = 3$ & $\dfrac{30}{1} = 30$ & 11.12 \\ 
		  $\textbf{NEW2}$ & $\dfrac{30}{2}=15$ & $\dfrac{60}{1} = 60$ & $\dfrac{20}{3} = 6.67$ & $\dfrac{20}{8} = 2.5$ & 21.04 \\ 
		  $\textbf{NEW3}$ & $\dfrac{70}{1}=70$ & $\dfrac{35}{3} = 11.67$ & $\dfrac{30}{2} = 15$ & $\dfrac{10}{13} = 0.77$ & 24.36 \\
	      \bottomrule
	    \end{tabular}
	    \caption{ System Power }
	  \end{table}


\newpage
\section{$\textbf{Optimizing CPU Time}$}
	Let the total instruction count be $x$. Thus we have the following count of instructions per type of instructions
	\begin{eqnarray*}
		\mbox{Load} &=& 0.1 x, \quad\mbox{and}, \quad\mbox{\# cycles = } 0.2x \\
		\mbox{Store} &=& 0.05 x, \quad\mbox{and}, \quad\mbox{\# cycles = } 0.05x \\
		\mbox{Branch} &=& 0.05 x, \quad\mbox{and}, \quad\mbox{\# cycles = } 0.1x \\
		\mbox{ADD} &=& 0.3 x, \quad\mbox{and}, \quad\mbox{\# cycles = } 0.3x \\
		\mbox{MULT} &=& 0.5 x, \quad\mbox{and}, \quad\mbox{\# cycles = } 2x \\
	\end{eqnarray*}

	Thus the Old CPI will be 
	\[\mbox{CPI}_{old} = \dfrac{0.2x + 0.05x + 0.1x + 0.3x + 2x}{x} = 2.65 \]

	Hence, the old IPC will be
	\[\mbox{IPC}_{old} = \dfrac{1}{2.65} = 0.377 \]

	Given that $60\%$ of the MULT instructions could be combined with ADD, we observe that $60\%$ of the MULT instructions is $\textbf{0.3x}$. Thus all the ADD instructions get combined with the MULT instructions , leaving $0.2x$ MULT instructions that are unfused. Thus, the new bunch of instrcutions and their cycle count will be as follows
	\begin{eqnarray*}
		\mbox{Load} &=& 0.1 x, \quad\mbox{and}, \quad\mbox{\# cycles = } 0.2x \\
		\mbox{Store} &=& 0.05 x, \quad\mbox{and}, \quad\mbox{\# cycles = } 0.05x \\
		\mbox{Branch} &=& 0.05 x, \quad\mbox{and}, \quad\mbox{\# cycles = } 0.1x \\
		\mbox{MULT} &=& 0.2 x, \quad\mbox{and}, \quad\mbox{\# cycles = } 0.8x \\
		\mbox{FMAD} &=& 0.3 x, \quad\mbox{and}, \quad\mbox{\# cycles = } 1.2x \\
	\end{eqnarray*}

	Thus the New CPI will be
	\[\mbox{CPI}_{new} = \dfrac{0.2x + 0.05x + 0.1x + 0.8x + 1.2x}{0.1x + 0.05x + 0.05x + 0.2x + 0.3x} = 3.35 \]

	Hence, the new IPC will be
	\[\mbox{IPC}_{new} = \dfrac{1}{3.35} = 0.29 \]

	Old execution time can be evaluated as
	\[Exec_{old} = CPI_{old} \times IC_{old} \times CT = 2.65x \times CT\]
	New execution time can be evaluated as
	\[Exec_{new} = CPI_{new} \times IC_{new} \times CT = \dfrac{2.35x}{0.7x} \times 0.7x \times CT\]

	Hence, 
	\[
		Speed-up = \dfrac{Exec_{old}}{Exec_{new}} = \dfrac{2.65x}{2.35x} = 1.127
	\]

	Thus there is a net speedup of $1.127$ using $FMAD$.

\newpage
\section{$\textbf{Amdahl's Law}$}
	Let the total energy consumption in the mobile device is $x$ Joules. The fractions of energy consumed by each part of the given unit can be summarized in Table:~\ref{tab:frac-tab}
	\begin{table}[!htb]
	    \centering
	    \fontfamily{ppl}\selectfont
		\renewcommand{\arraystretch}{3.0}
		\label{tab:frac-tab}
	    \begin{tabular}{c|c|c|c|}
	      \toprule
		  \multicolumn{4}{|c|}{Energy Distribution}  \\
	      \midrule 
		  $\textbf{Wireless Interface}$ & $\textbf{Display}$ & $\textbf{CPU}$ & $\textbf{Other}$ \\  % = \dfrac{1}{4}\sum_{i=1}^4 w_i x_i$ 
		  $50\% \equiv \dfrac{1}{2}x$  & $20\% \equiv \dfrac{1}{5}x$ & $10\% \equiv \dfrac{1}{10}x$ & $20\% \equiv \dfrac{1}{5}x$ \\
	      \bottomrule
	    \end{tabular}
	    \caption{ System Power }
	  \end{table}

	  We can apply Amdahl's law to find maximum improvement possible when some fraction of the component is improved. In this case the component is energy. We denote by $E_{overall}$ as the overall energy of the system and $f_{enhanced}$ as the franction of the enhanced component. Then the formula for the specific case of this problem in terms of energy can be summarized as:
	  \begin{eqnarray*}
	  	E_{overall_{new}} &=& (1 - f_{enhanced} + \dfrac{f_{enhanced}}{\mbox{Improvement speedup}}) \times E_{overall_{old}} \\
		Speedup &=& \dfrac{E_{overall_{old}}}{E_{overall_{new}}}
	  \end{eqnarray*}

	  Where, in case of energy, the $Improvement\ speedup$ can be defined as
	  \[
	  	\mbox{Improvement speedup} = \dfrac{Energy_{enehanced_{old}}}{Energy_{enhanced_{new}}}
	  \]

	  Applying the above set of formulae to the given cases for energy optimization

	  \subsection{$\textbf{Reduce wireless interface energy by 10\%}$}
	  	Then we get improvement speedup and the new Overall energy as
		\begin{eqnarray*}
			\mbox{Improvement Speedup} &=& \dfrac{Energy_{enehanced_{old}}}{Energy_{enhanced_{new}}} = \dfrac{\dfrac{x}{2}}{\dfrac{x}{2} - 10\%\ of \dfrac{x}{2}}\\
			&=& \dfrac{10}{9} \\
			E_{overall_{new}} &=& (1 - f_{enhanced} + \dfrac{f_{enhanced}}{\mbox{Improvement speedup}}) \times E_{overall_{old}} \\
			&=& ( 1 - \dfrac{1}{2} + \dfrac{\dfrac{1}{2}}{\dfrac{10}{9}})\times E_{overall_{old}} \\
			&=& 0.95 E_{overall_{old}}
		\end{eqnarray*}

		Thus reducing wireless interface energy by $10\%$ results in an \boxed{\mathbf{overall\ energy\ reduction\ of\ 5\%}}.

	  \subsection{$\textbf{Reducing CPU energy by 60\%}$}
	  	Then we get improvement speedup and the new Overall energy as
		\begin{eqnarray*}
			\mbox{Improvement Speedup} &=& \dfrac{Energy_{enehanced_{old}}}{Energy_{enhanced_{new}}} = \dfrac{\dfrac{x}{10}}{\dfrac{x}{10} - 60\%\ of \dfrac{x}{10}}\\
			&=& \dfrac{5}{2} \\
			E_{overall_{new}} &=& (1 - f_{enhanced} + \dfrac{f_{enhanced}}{\mbox{Improvement speedup}}) \times E_{overall_{old}} \\
			&=& ( 1 - \dfrac{1}{10} + \dfrac{\dfrac{1}{10}}{\dfrac{5}{2}})\times E_{overall_{old}} \\
			&=& 0.94 E_{overall_{old}}
		\end{eqnarray*}
		Thus reducing CPU energy by $60\%$ results in an \boxed{\mathbf{overall\ energy\ reduction\ of\ 6\%}}.

	  \subsection{$\textbf{Reducing display energy by 50\%}$}
	  	Then we get improvement speedup and the new Overall energy as
		\begin{eqnarray*}
			\mbox{Improvement Speedup} &=& \dfrac{Energy_{enehanced_{old}}}{Energy_{enhanced_{new}}} = \dfrac{\dfrac{x}{10}}{\dfrac{x}{5} - 50\%\ of \dfrac{x}{5}}\\
			&=& 2 \\
			E_{overall_{new}} &=& (1 - f_{enhanced} + \dfrac{f_{enhanced}}{\mbox{Improvement speedup}}) \times E_{overall_{old}} \\
			&=& ( 1 - \dfrac{1}{5} + \dfrac{\dfrac{1}{5}}{2})\times E_{overall_{old}} \\
			&=& 0.90 E_{overall_{old}}
		\end{eqnarray*}
		Thus reducing display energy by $50\%$ results in an \boxed{\mathbf{overall\ energy\ reduction\ of\ 10\%}}.

		Thus, we see that the third option of reducing display energy by $50\%$ gives the best improvement in energy saving since the overall energy gets reduced by $10\%$.


\newpage
\section{$\textbf{Power and Energy}$}
	Given,
	\begin{eqnarray*}
		\mbox{Frequency, } f &=& 2Ghz \\
		\mbox{Dynamic power, } P_d &=& 70 W \\
		\mbox{Static power, } P_s &=& 30 W \\
		T_{exec} &=& 15 s \\
	\end{eqnarray*}

	\subsection{i. Compute the energy consumed for executing the application:}
		\begin{eqnarray*}
			\mbox{Total Energy} &=& (P_s + P_d)\times T_{exec} \\
			&=& (70 + 30) \times 15 Joules \\
			&=& 1500 Joules
		\end{eqnarray*}

		\boxed{Total\ Energy = 1500\ Joules}

	\subsection{ii. Energy consumption of frequency scales down by 30\%:}
		Scaling down frequency affects inversely the executuin time as well, and the Dynamic power component.
		The new frequency and execution time will be
		\begin{eqnarray*}
			f_{new} &=& 0.7 f \\
			T_{exec_{new}} &=& \dfrac{T_{exec}}{0.7} 
		\end{eqnarray*}

		The dynamic power componnet is expressed as 
		\[
			Power_{dyn} = Activity \times Capacitance \times Voltage^2 \times Frequency
		\]
		In dynamic power, all the other components remaining same, the dynamic power scales by the same amount that frequency scales.
		Hence, the new dynamic power is
		\[
			P_{d_{new}} = 0.7 \times P_d
		\]

		Thus, the new energy consumption be comes:
		\begin{eqnarray*}
			\mbox{New Total Energy} &=& (P_s + 0.7 P_d) \dfrac{T_{exec}}{0.7} \\
			&=& = (30 + 0.7 \times 70) \dfrac{15}{0.7} \\
			&=& 1692
		\end{eqnarray*}

		\boxed{New\ Total\ Energy = 1692\ Joules}

	\subsection{iii. Energy consumption if both voltage and frequency scale down by 30\%:}
	Additionally if we scale the voltage down by $30\%$, it affects both dynamic power and static power as shown.  
	\begin{eqnarray*}
		P_{static} &=& Current \times Voltage = 0.7 \times P_s \\
		P_{dynamic} &=& Activity \times Capacitance \times Voltage^2 \times Frequency = (0.7)^3 \times P_d
	\end{eqnarray*}
	\begin{eqnarray*}
		\mbox{New Total Energy} &=& ( 0.7 \times P_s + (0.7)^3 \times P_d) \times \dfrac{15}{0.7} = 964.5 Joules
	\end{eqnarray*}
		\boxed{New\ Total\ Energy = 964.5\ Joules}

\newpage
\section{Instruction set Architecture}
	\begin{itemize}
		\item $\textbf{LOAD R5, 6000(R0)}$
			\begin{eqnarray*}
			\mbox{Effective Address} &=& 6000 + [R0] = 6000 + 1000 = 7000 \\
			R5 &\leftarrow& Mem[7000] \\
			R5 &\leftarrow& 1
			\end{eqnarray*}
			Calculates the effective address as shown of $7000$, then load the data from memory address $7000$ into R5. R5 is updated to 1

		\item $\textbf{ADD R4, (R4)}$
		\begin{eqnarray*}
			\mbox{Effective Address} &=& Mem[R4] = 6000 \\
			R4 &\leftarrow& R4 + Mem[6000] = 6000+12 = 6012 \\
		\end{eqnarray*}
	
		\item $\textbf{SUB R2, R1}$
			\begin{eqnarray*}
				R2 &\leftarrow& R2 - R1 \\
				R2 &\leftarrow& 99 - 25 = 74 \\
			\end{eqnarray*}

		\item $\textbf{LOAD R6, @(R0)}$
			\begin{eqnarray*}
				\mbox{Effective Address} &=& Mem[R0] = Mem[1000] = 3000 \\
				R6 &\leftarrow& Mem[3000] \\
				R6 &\leftarrow& 33
			\end{eqnarray*}

		\item $\textbf{ADD R6, R4}$
			\begin{eqnarray*}
				R6 &\leftarrow& R6 + R4 \\
				R6 &\leftarrow& 33 + 6012 \\
				R6 &\leftarrow& 6045
			\end{eqnarray*}

		\item $\textbf{SUB R5, R6}$
			\begin{eqnarray*}
				R5 &\leftarrow& R5 - R6 \\
				R5 &\leftarrow& 1 - 6045 \\
				R5 &\leftarrow& - 6044 \\
			\end{eqnarray*}

		\item $\textbf{ADD R2, R5}$
			\begin{eqnarray*}
				R2 &\leftarrow& R2 + R5 \\
				R2 &\leftarrow& 74 - 6044 \\
				R2 &\leftarrow& -5970 \\
			\end{eqnarray*}

		\item $\textbf{ADD R2, (R3+R0)}$
			\begin{eqnarray*}
				\mbox{Effective Address} &=& R3 + R0 = 4000 + 1000 = 5000 \\
				R2 &\leftarrow& R2 + Mem[5000] \\
				R2 &\leftarrow& -5970 + 71 \\
				R2 &\leftarrow& -5899 \\
			\end{eqnarray*}

	\end{itemize}

		
  \bibliography{cs6810}
  \bibliographystyle{plainnat}
  
  \end{document}
